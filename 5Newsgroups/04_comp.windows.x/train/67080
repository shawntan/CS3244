from: prunet@zephir.inria.fr (vincent prunet)
subject: re: monthli question about xcopyarea() and expos event
organ: inria, sophia-antipoli (fr)
line: 55

in articl <buzz.93apr19125438@lion.bear.com>, buzz@bear.com (buzz moschetti)
write:
|> (2nd post of the question that just doesn't seem to get answer)
|> 
|> suppos you have an idl app with a realiz and map window that
|> contain
|> xlib graphic.  a button widget, when press, will caus a new item
|> to be drawn in the window.  thi action clearli should not call xcopyarea()
|> |> (or equiv) directli; instead, it should regist the exist of the
|> new
|> item in a memori structur and let the same expos event handler that
|> handl
|> "regular" expos event (e.g. window manag-driven exposur) take care
|> of render the new imag.  us an expos event handler is a "proper"
|> wai
|> to do thi becaus at the time the handler is call, the xlib window is
|> guarante to be map.
|> 
|> the problem, of cours, is that no expos event is gener if the window
|> is alreadi visibl and map.  what we need to do is somehow "tickl" the
|> window so that the expos handler is hit with argument that will enabl
|> it to render *just* the part of the window that contain the new item.
|> 
|> what is the best wai to tickl a window to produc thi behavior?

to increment updat the content of window, i us the follow trick:

	1. set the window background to none,
	2. call xcleararea(displai, window, 0, 0, 0, 0, true),
	3. restor the window background to it correct valu.

the call to xcleararea doe not repaint the window background, but still
gener exposur event for visibl part of the window.

in order to let my applic know that these expos event must be handl
increment (someth is alreadi displai on the screen and mai need to
be eras), i encapsul the 3 oper with 2 self address client
messag, which preserv asynchron between the client and the server.

xgrabserv(displai)
client messag (start-increment)
 	background none
	xcleararea
	restor background 
client messag (end-increment)
xungrabserv(displai)

the grabserv prevent other event to be insert by the server in the
critic section.

---
vincent prunet, sema group sophia antipoli
inria       bp 93    06902 sophia antipoli cedex  franc
prunet@sophia.inria.fr, (33) 93 65 78 42, fax:(33) 93 65 77 66

